<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.prime.com.tr/ui" 
	template="../../templates/default.xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html">
	
	<ui:define name="content">
		<h:form prependId="false">
			<p:messages id="messages" showDetail="false" autoUpdate="false" closable="true" /> 
			<p:growl id="grlMessages" showDetail="false" autoUpdate="false" closable="true" />  
			
			<p:tabView id="tvAta" style="height: 250px;"> 
				<p:tab id="tabAta" title="#{msg.resolve('tab.ata.register')}">
					<p:spacer width="20" height="15"/>
				 
					<h:panelGroup id="pgroupAta">
						<h:panelGrid columns="2" cellpadding="2" cellspacing="1">
								<h:outputLabel value="#{msg.resolve('label.name')}" for="txtName">
									<p:spacer  width="28" height="2"/>
								</h:outputLabel>  
								<p:inputText id="txtName" value="#{ataBean.ata.name}" required="true" size="40" 
											requiredMessage="#{msg.resolveMsg('required.field', 'label.name')}"/>
						</h:panelGrid>
						<h:panelGrid columns="5" cellpadding="2" cellspacing="5">
								<h:outputLabel value="#{msg.resolve('label.start')}" for="cldStart">
									<p:spacer  width="20" height="2"/>
								</h:outputLabel>
								<p:calendar id="cldStart" value="#{ataBean.ata.start}" required="true" size="12" pattern="dd/MM/yyyy"
											 showOn="button" requiredMessage="#{msg.resolveMsg('required.field', 'label.start')}" >
									<p:ajax event="dateSelect" listener="#{ataBean.minEndRegistryHandle}" 
											process="@this" update="cldEnd, tvAta:pgroupApprovalPeriod" />
								</p:calendar>					
								
								<p:spacer width="5"/>
								
								<h:outputLabel value="#{msg.resolve('label.end')}" for="cldEnd" />
								<p:calendar id="cldEnd" value="#{ataBean.ata.end}" required="true" 
										pattern="dd/MM/yyyy" size="12" showOn="button" mindate="#{ataBean.minEndAta}"
										requiredMessage="#{msg.resolveMsg('required.field', 'label.end')}">
									<p:ajax event="dateSelect" listener="#{ataBean.maxEndExceptionHandle}" 
											process="@this" update="tvAta:pgroupApprovalPeriod, pgExceptionDates"/>
								</p:calendar>		
						</h:panelGrid>
						
						<h:panelGrid columns="4" cellpadding="2" cellspacing="5">
								<h:outputLabel value="#{msg.resolve('label.month')}" for="cbxMonth">
									<p:spacer width="28" height="2"/>
								</h:outputLabel> 
								<p:selectOneMenu id="cbxMonth" value="#{ataBean.ata.month}" 
											required="true" 
											requiredMessage="#{msg.resolveMsg('required.field', 'label.month')}">
									<f:selectItem itemLabel="#{msg.resolve('select.one.option')}"/>  
									<f:selectItems value="#{ataBean.month}" 
											var="m" itemValue="#{m.month}" itemLabel="#{m.month} - #{m.name}"/> 
								</p:selectOneMenu>
								
								<h:outputLabel value="#{msg.resolve('label.year')}" for="cbxYear"/> 
								<p:selectOneMenu id="cbxYear" value="#{ataBean.ata.year}"
											required="true"   
											requiredMessage="#{msg.resolveMsg('required.field', 'label.year')}">
									<f:selectItem itemLabel="#{msg.resolve('select.one.option')}"/>  
									<f:selectItems value="#{ataBean.years}"  
											var="y" itemValue="#{y.year}" itemLabel="#{y.name}"/>
								</p:selectOneMenu>
						</h:panelGrid>
						
						<h:panelGrid columns="2" cellpadding="4" cellspacing="3">
								<h:outputLabel value="#{msg.resolve('label.description')}" for="txaDescription"/>
								<p:inputTextarea id="txaDescription" cols="67" rows="6" value="#{ataBean.ata.description}" autoResize="false"/>
						</h:panelGrid>
						
					</h:panelGroup>
					
				</p:tab>
				<p:tab id="tabPeriod" title="#{msg.resolve('tab.period.approval.registry')}">
						<p:spacer width="20" height="15"/>
						
						<h:panelGroup id="pgroupApprovalPeriod">
							<h:panelGrid columns="5" cellpadding="2" cellspacing="5">
									<h:outputLabel value="#{msg.resolve('label.start')}" for="cldStartApproval"/>
									<p:calendar id="cldStartApproval" value="#{ataBean.ata.registryStart}" required="true" size="12"
											maxdate="#{ataBean.maxStartRegistry}" pattern="dd/MM/yyyy" showOn="button"
											requiredMessage="#{msg.resolveMsg('required.field', 'label.start')}">
										<p:ajax event="dateSelect" listener="#{ataBean.minStartEndRegistryHandle}" 
												process="@this" update="cldEndApproval"/>
									</p:calendar>		
									
									<p:spacer width="5"/>
									
									<h:outputLabel value="#{msg.resolve('label.end')}" for="cldEndApproval"/>
									<p:calendar id="cldEndApproval" value="#{ataBean.ata.registryEnd}" required="true" size="12"
											mindate="#{ataBean.minEndRegistry}" maxdate="#{ataBean.maxStartRegistry}" pattern="dd/MM/yyyy" showOn="button" 
											requiredMessage="#{msg.resolveMsg('required.field', 'label.end')}">
											<p:ajax event="dateSelect" listener="#{ataBean.minStartExceptionHandle}" 
													process="@this" update="pgroupExcecoes, pgExceptionDates"/>
									</p:calendar>		
							</h:panelGrid>
						</h:panelGroup>
				</p:tab>
				<p:tab id="tabException" title="#{msg.resolve('tab.exceptions.registry')}" >
						<p:spacer width="20" height="10"/>
							
						<h:panelGrid columns="1" style="width: 600px; text-align:right !important;" >			
							<p:commandLink title="#{msg.resolve('link.new')}" onclick="dlgException.show()" immediate="true">
								<h:graphicImage name="novo.png" library="images"/>
							</p:commandLink>
							<p:spacer width="20" height="10"/>
						</h:panelGrid>
						
						<p:dataTable widgetVar="dgException" id="dgExceptions" style="width: 600px;" var="excecao" value="#{ataBean.excecoes}" 
								emptyMessage="#{msg.resolve('data.table.empty')}" >
						
							<f:facet name="header">  
					            <h:outputLabel value="#{msg.resolve('label.exception.registred')}" />
					        </f:facet>  
					        
					        <p:column headerText="#{msg.resolve('label.branch.name')}" style="width: 280px;">  
					            <h:outputText value="#{excecao.branch.name}"/>  
					        </p:column>  
					  
					        <p:column headerText="#{msg.resolve('label.start')}" style="width: 100px;">  
					            <h:outputText value="#{excecao.start}" >
					            	 <f:convertDateTime pattern="dd/MM/yyyy"/>
					            </h:outputText>  
					        </p:column>  
					  
					        <p:column headerText="#{msg.resolve('label.end')}" style="width: 100px;">  
					            <h:outputText value="#{excecao.end}" >
					            	 <f:convertDateTime pattern="dd/MM/yyyy"/>
					            </h:outputText>    
					        </p:column>  
					        
					         <p:column headerText="#{msg.resolve('label.actions')}" style="width:35px; text-algin: center;">  
					            <p:commandLink title="#{msg.resolve('label.edit')}" immediate="true" process="@this" 
					            		update="pgroupExcecoes" oncomplete="dlgException.show();">
									<h:graphicImage name="pencil.png" library="images"/>
									<f:setPropertyActionListener target="#{ataBean.excecaoSelected}" value="#{excecao}"/>
								</p:commandLink>
								 <p:commandLink title="#{msg.resolve('label.exclude')}" process="@this" update="tvAta:dgExceptions"
								 		actionListener="#{ataBean.removeExcecao(excecao)}">
									<h:graphicImage name="delete.png" library="images"/>
								</p:commandLink>
					        </p:column>  
						</p:dataTable>
				</p:tab>
			</p:tabView>
			
			<h:panelGrid columns="1" style="width: 100%; text-align:right !important;">
				<p:spacer width="100%" height="10"/>	
				<h:panelGroup>	
					<p:commandButton id="btnCancel" immediate="true" ajax="false" image="ui-icon ui-icon-close"
				 					value="#{msg.resolve('label.cancel')}" action="#{ataBean.linkRedirect()}"/>
						
					<p:spacer width="5"/>
					
				 	<h:panelGroup>			
						<p:commandButton id="btnSave" process="@this, tvAta, tvAta:messages" update="tvAta, messages, grlMessages"
								oncomplete="saveCompleteHandle(xhr, status, args);" image="ui-icon ui-icon-disk"
								value="#{msg.resolve('label.save')}" actionListener="#{ataBean.save}"/>
					</h:panelGroup>
				</h:panelGroup>
			</h:panelGrid>
			
			<p:confirmDialog widgetVar="cdlgSaveConfirm" severity="alert" closable="false"
					header="#{msg.resolve('dialog.header.new.ata')}" message="#{msg.resolve('dialog.message.ata')}" >
					
				<h:panelGrid columns="1" style="width: 100%; text-align:right !important;">
				 	<h:panelGroup>			
						<p:commandButton id="btnYes" value="#{msg.resolve('label.yes')}" process="@this"
								update="tvAta, tvAta:messages" oncomplete="cdlgSaveConfirm.hide()"  actionListener="#{ataBean.clear}" />  
								
	       				<p:commandButton id="btnNo" value="#{msg.resolve('label.no')}" process="@this" update="tvAta:messages" 
	       						oncomplete="cdlgSaveConfirm.hide()" action="#{ataBean.linkRedirect}" immediate="true" ajax="false" />
					</h:panelGroup>
				</h:panelGrid>			
       				
			</p:confirmDialog>
			
			<p:dialog widgetVar="dlgException" modal="true" header="#{msg.resolve('tab.exceptions.registry')}" resizable="false">
				<p:messages id="dlgMessages" showDetail="false" autoUpdate="false" closable="true" />  
				<p:spacer width="20" height="10"/>
			
				<h:panelGroup id="pgroupExcecoes">
					<h:panelGrid columns="2" cellpadding="4" cellspacing="5">
						<h:outputLabel value="#{msg.resolve('label.branch')}" for="cbxBranch">
									<p:spacer  width="4" height="2"/>
						</h:outputLabel>
						<p:inputText enabled="false" rendered="#{ataBean.excecaoSelected.branch != null}" disabled="true"
								value="#{ataBean.excecaoSelected.branch.code} - #{ataBean.excecaoSelected.branch.name}" />
						<p:selectOneMenu rendered="#{ataBean.excecaoSelected.branch == null}" id="cbxBranch" style="width: 265px;" required="true" 
							value="#{ataBean.branchSelected}" requiredMessage="#{msg.resolveMsg('required.field', 'label.branch')}">
							<f:selectItem itemLabel="#{msg.resolve('select.one.option')}"/>  
							<f:selectItems value="#{ataBean.branches}" var="branch" 
									itemValue="#{branch.id}" itemLabel="#{branch.code} - #{branch.name}"/> 
						</p:selectOneMenu>
					</h:panelGrid>
					
					<h:panelGrid id="pgExceptionDates" columns="5" cellpadding="4" cellspacing="5">
						<h:outputLabel value="#{msg.resolve('label.start')}" for="cldStartException"/>
						<p:calendar id="cldStartException" value="#{ataBean.excecaoSelected.start}" required="true" size="12"
									maxdate="#{ataBean.maxEndException}"
									pattern="dd/MM/yyyy" showOn="button" requiredMessage="#{msg.resolveMsg('required.field', 'label.start')}">
							<p:ajax event="dateSelect" listener="#{ataBean.maxStartEndExceptionHandle}" process="@this" update="cldEndException"/>
						</p:calendar>			
						
						<h:outputLabel value="#{msg.resolve('label.end')}" for="cldEndException"/>
						<p:calendar id="cldEndException" value="#{ataBean.excecaoSelected.end}" required="true" size="12"
									maxdate="#{ataBean.maxEndException}"
									pattern="dd/MM/yyyy" showOn="button" requiredMessage="#{msg.resolveMsg('required.field', 'label.end')}"/>
									
						<p:commandLink title="#{msg.resolve('label.add')}" oncomplete="addExcecaoCompletehandle(xhr, status, args);" 
									actionListener="#{ataBean.addExcecao}"
									process="@this, pgroupExcecoes" update="dlgMessages, tvAta:dgExceptions">
							<h:graphicImage name="selecionar.png" library="images"/>
						</p:commandLink>
					</h:panelGrid>
				</h:panelGroup>
				
				<p:spacer width="20" height="10"/>
				
				<h:panelGrid columns="1" style="width: 98%; text-align:right !important;">			
						
						<p:spacer width="20" height="10"/>
				</h:panelGrid>
			</p:dialog>
		</h:form>
	</ui:define>
	
	 <ui:define name="script">       
        function saveCompleteHandle(xhr, status, args) {     
	        if(args.firstSave) {
	        	cdlgSaveConfirm.show();
	        }
        }
        
        function addExcecaoCompletehandle(xhr, status, args) {     
        	if(args.addExcecaoComplete) {
	        	dlgException.hide();
	        }
        }
        
    </ui:define>
	
</ui:composition>
